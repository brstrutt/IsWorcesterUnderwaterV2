## Notes

### Github Pages 404 errors

When first published this site threw 404 errors when it tried to load the wasm bundles and css files.
This is because github pages sees "*load /styles.css*" and tries to load them from `https://brstrutt.github.io/styles.css`.
Obviously this fails because the styles are ACTUALLY at `https://brstrutt.github.io/IsWorcesterUnderwaterV2/styles.css`.
Looks like one solution is to remove the opening `/` from the filepaths....but how can I get trunk to do that?
The solution seems to be to create a `Trunk.toml` file containing the following:
```toml
[build]
public_url = "/IsWorcesterUnderwaterV2/"
```
Now my release build has the specified `public_url` prefixed onto all the 404-ing links.
Do be aware this means that running `trunk serve` will host the site at `http://127.0.0.1:8080/IsWorcesterUnderwaterV2`, which means the "open this page in the browser" popup will point at a 404 page.

### The wave animation

#### Previous implementation

The old site made the waves effect using pure CSS. Pretty cool, but kinda hard to understand.
Basically, it followed [this video](https://www.youtube.com/watch?v=Tf6qm5JMUXQ). Do something like this:

```css
.insideTheWave {
    animation: waveKeyframes 10s linear infinite;
}

@keyframes waveKeyframes {
    0% {
        clip-path: polygon(
            0% 100%,
            var(--Keyframe0),
            100% 100% );
    }
    50% {
        clip-path: polygon(
            0% 100%,
            var(--Keyframe1),
            100% 100% );
    }
    100% {
        clip-path: polygon(
            0% 100%,
            var(--Keyframe0),
            100% 100% );
    }
}
```

In the above the `--Keyframe0` and `--Keyframe1` variables are generated by PHP and injected into the page as a separate css file.

#### New implementation

Now I need to do something similar in Rust, but without it being the unreadable mess that this PHP implementation kinda ended up being.
I can't just inject css keyframe variables like I did with PHP, so I'm thinking use inline styles for this. Kinda unpleasant but might be easier to work with.

Ok it looks like you can't inline the @keyframe declaration. Bummer.
But you CAN inline the css variables! Ok new plan: do that.

### Failed to find a valid digest in the 'integrity' attribute

```
Error: Failed to find a valid digest in the 'integrity' attribute for resource 'https://isworcesterunderwater.co.uk/is_worcester_underwater-1cdf5d919e400bdd.js' with computed SHA-384 integrity 'o1xy/QFp7KNYu/uP825tZ9FqzLRRdMCY4Nnuzfd853IzOC+3Jy8mdy4a+UG1p5D/'. The resource has been blocked.

Warning: The `integrity` attribute is currently ignored for preload destinations that do not support subresource integrity. See https://crbug.com/981419 for more information
```
When I try to load the page in chromium on the most recent build it shows a white screen. The above errors end up in the console. So I guess trunk has started doing something funky when it builds to try and optimise shit, but it's not quite supported or something?

Note the page does load once in a blue moon. Probably when it tries to re-use the rust blob it already downloaded. FUCK.

Fixed it by turning off integrity with `build.no_sri=true` in the Trunk.toml.

### wasm-opt failing

Placing `<link data-trunk rel="rust"/>` in the index.html should work fine. Instead it breaks release builds at the wasm optimisation step.
I have confirmed this is an issue with Yew. The example Yew counter program breaks if this single line is added. The same error does not occur when using Leptos instead of Yew.
This isn't too much of an issue for me right now, but in future I may want to think about migrating to something else such as Dioxus. Unless Yew can fix this issue in the next release...(the last release was just over a year ago now so it's not surprising that it's a little fucked).
